<div style="margin-bottom: 20px;">
  <a href="/products" class="btn btn-primary">‚¨ÖÔ∏è Volver a Productos</a>
</div>

<div style="max-width: 900px; margin: 0 auto;">
  <h1>{{product.title}}</h1>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 30px;">
    
    <!-- Columna izquierda: Imagen (placeholder) -->
    <div>
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 400px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">
        {{#if product.thumbnails.length}}
          üì∑ {{product.thumbnails.length}} imagen(es)
        {{else}}
          üì¶ Sin imagen
        {{/if}}
      </div>
      
      {{#if product.thumbnails.length}}
        <div style="margin-top: 15px;">
          <strong>Im√°genes:</strong>
          <ul style="list-style: none; padding: 0; margin-top: 10px;">
            {{#each product.thumbnails}}
              <li style="background: #f8f9fa; padding: 8px; margin-bottom: 5px; border-radius: 5px; font-size: 14px;">
                üñºÔ∏è {{this}}
              </li>
            {{/each}}
          </ul>
        </div>
      {{/if}}
    </div>

    <!-- Columna derecha: Informaci√≥n -->
    <div>
      <div class="product-price" style="margin-bottom: 20px;">${{product.price}}</div>

      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="margin-bottom: 15px; font-size: 18px;">üìù Descripci√≥n</h2>
        <p style="color: #666; line-height: 1.6;">{{product.description}}</p>
      </div>

      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="margin-bottom: 15px; font-size: 18px;">‚ÑπÔ∏è Informaci√≥n del Producto</h2>
        
        <div style="display: grid; gap: 12px;">
          <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 5px;">
            <strong>C√≥digo:</strong>
            <span class="product-code">{{product.code}}</span>
          </div>

          <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 5px;">
            <strong>Categor√≠a:</strong>
            <span>{{product.category}}</span>
          </div>

          <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 5px;">
            <strong>Stock disponible:</strong>
            <span style="{{#if (eq product.stock 0)}}color: #dc3545; font-weight: bold;{{/if}}">
              {{product.stock}} unidades
            </span>
          </div>

          <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 5px;">
            <strong>Estado:</strong>
            <span class="product-status {{#if product.status}}status-active{{else}}status-inactive{{/if}}">
              {{#if product.status}}‚úì Activo{{else}}‚úó Inactivo{{/if}}
            </span>
          </div>
        </div>
      </div>

      <!-- Bot√≥n de agregar al carrito -->
      {{#if product.status}}
        {{#if (gt product.stock 0)}}
          <button class="btn btn-success btn-block" onclick="addToCart('{{product._id}}')" style="font-size: 18px; padding: 15px;">
            üõí Agregar al Carrito
          </button>
          
          <div style="margin-top: 15px;">
            <label for="quantity" style="display: block; margin-bottom: 8px; font-weight: 600;">Cantidad:</label>
            <input type="number" id="quantity" min="1" max="{{product.stock}}" value="1" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;">
          </div>
        {{else}}
          <button class="btn btn-block" style="background: #dc3545; color: white; cursor: not-allowed; font-size: 18px; padding: 15px;" disabled>
            ‚ùå Sin Stock
          </button>
        {{/if}}
      {{else}}
        <button class="btn btn-block" style="background: #6c757d; color: white; cursor: not-allowed; font-size: 18px; padding: 15px;" disabled>
          ‚ö†Ô∏è Producto No Disponible
        </button>
      {{/if}}

      <a href="/products" class="btn btn-primary btn-block" style="margin-top: 15px;">
        ‚¨ÖÔ∏è Seguir Comprando
      </a>
    </div>
  </div>
</div>

<script>
  async function addToCart(productId) {
    try {
      const quantity = parseInt(document.getElementById('quantity').value);
      
      if (quantity < 1) {
        alert('‚ùå La cantidad debe ser al menos 1');
        return;
      }

      // Obtener o crear carrito
      let cartId = localStorage.getItem('cartId');
      
      if (!cartId) {
        const createResponse = await fetch('/api/carts', {
          method: 'POST'
        });
        const createData = await createResponse.json();
        cartId = createData.payload._id;
        localStorage.setItem('cartId', cartId);
      }

      // Agregar producto al carrito la cantidad de veces indicada
      for (let i = 0; i < quantity; i++) {
        await fetch(`/api/carts/${cartId}/product/${productId}`, {
          method: 'POST'
        });
      }

      alert(`‚úÖ ${quantity} producto(s) agregado(s) al carrito`);
      
      if (confirm('¬øDeseas ver tu carrito?')) {
        window.location.href = `/carts/${cartId}`;
      }
    } catch (error) {
      alert('‚ùå Error al agregar producto: ' + error.message);
    }
  }
</script>

<style>
  @media (max-width: 768px) {
    div[style*="grid-template-columns: 1fr 1fr"] {
      display: block !important;
    }
  }
</style>